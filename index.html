<!DOCTYPE html>
<head>

<title>CTBeethoven</title>

</head>
<html>
<body onmousemove="coordinate(event)" onclick="clicky(event)">

<canvas id="myCanvas" width="550" height="400" style="border:2px solid #000000;">
Your browser does not support the HTML canvas tag.</canvas>

<canvas id="myCanvas2" width="550" height="400" style="border:2px solid #000000;" hidden>
Your browser does not support the HTML canvas tag.</canvas>

<script>

var objects=[];
var imgs=[];
var canvas = document.getElementById("myCanvas");
var canvas2 = document.getElementById("myCanvas2");
var ctx = document.getElementById("myCanvas").getContext("2d");
var ctx2 = document.getElementById("myCanvas2").getContext("2d");
var mouseX=0;
var mouseY=0;

function coordinate(event) {
	mouseX=event.clientX-canvas.getBoundingClientRect().left;
    mouseY=event.clientY-canvas.getBoundingClientRect().top;
}

function clicky(event) {
	//alert(mouseX+" "+mouseY);
}

function renderObject(obj) {

    if(imgs[obj.img]==undefined) {

        var img = new Image();
        img.src=obj.img;
        imgs[obj.img]=img;
        img.onload = function() {
            renderImageObject(obj,this);
        };
    } else {
        var img=imgs[obj.img];
        renderImageObject(obj,img);
    }
}

function renderImageObject(obj,img) {
    ctx2.drawImage(img, 0, 0);
    var rows=obj.rows;
    var cols=obj.cols;
    var frame=obj.frame;
    var fX=frame%cols+1;
    var fY=Math.floor(frame/cols)+1;
    var IMGW=img.width/cols*fX;
    var IMGH=img.height/rows*fY;
    var UW=1;
    var UH=1;
    if(cols<=1) {
        UW=0;
    }
    if(rows<=1) {
        UH=0;
    }
    var imgData = ctx2.getImageData(IMGW-img.width/cols+UW, IMGH-img.height/rows+UH, img.width/cols-UW, img.height/rows-UH);
	var prevData = ctx.getImageData(obj.X, obj.Y, img.width/cols-UW, img.height/rows-UH);
    // go through pixels
    for (var i = 0; i < imgData.data.length; i += 4) {
        if(imgData.data[i+0]==0&&imgData.data[i+1]==255&&imgData.data[i+2]==0) {
			imgData.data[i+0]=prevData.data[i+0];
			imgData.data[i+1]=prevData.data[i+1];
			imgData.data[i+2]=prevData.data[i+2];
		}
    }
    obj.W=img.width/cols;
    obj.H=img.height/rows;
    ctx.putImageData(imgData, obj.X, obj.Y);
}

function newObject(X,Y,cols,rows,img) {
    var objy=[];
    objy.X=X;
    objy.Y=Y;
    objy.W=0;
    objy.H=0;
    objy.img=img;
    objy.frame=0;
    objy.cols=cols;
    objy.rows=rows;
    objects.push(objy);
    objy.hover=function(){};
    return objy;
}

function newButton(X,Y,cols,rows,img) {
    var objy=newObject(X,Y,cols,rows,img);
    objy.hover=function() {
        if(mouseX>=this.X&&mouseX<=this.W+this.X&&mouseY>=this.Y&&mouseY<=this.H+this.Y) {
            this.frame=1;
            return true;
        } else {
            this.frame=0;
        }
        return false;
    }
    return objy;
}

function newText(X,Y,text) {
	var l=0;
	var arr=[];
	for(var i=0;i<text.length;i++) {
		if(text.charAt(i)!=' '&&text.charAt(i)!='|') {
			var cc=text.charCodeAt(i)-97;
			var betty=newObject(X+i*15,Y+l*20,6,5,"text.png");
			betty.frame=cc;
		}
		if(text.charAt(i)=='|') {
			l++;
		}
	}
	return arr;
}


newObject(0,0,1,1,"background.png");
var btn1=newButton(5,5,1,2,"button.png");
var text1=newText(8,8,"start game");

const interval = setInterval(function() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for(var i=0;i<objects.length;i++) {
        if(objects[i]!=undefined) {
            objects[i].hover();
            renderObject(objects[i]);
        }
    }
},100)

</script>

</body>
</html>
